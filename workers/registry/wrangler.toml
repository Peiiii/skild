name = "skild-registry"
main = "src/index.ts"
compatibility_date = "2025-01-12"

routes = [
  { pattern = "registry.skild.sh/*", zone_name = "skild.sh" }
]

[vars]
# Cloudflare Workers WebCrypto PBKDF2 has an iteration upper bound (100000).
PBKDF2_ITERATIONS = "100000"
REGISTRY_PUBLIC_URL = "https://registry.skild.sh"
CONSOLE_PUBLIC_URL = "https://hub.skild.sh"

# Email verification (publish requires verified email).
# Modes:
# - "mailchannels" (recommended for prod): send emails via MailChannels.
# - "log": do not send; log the verification link (dev only).
EMAIL_MODE = "mailchannels"
EMAIL_FROM = "no-reply@skild.sh"
EMAIL_FROM_NAME = "skild"
EMAIL_VERIFY_TTL_HOURS = "24"

# Temporarily allow publishing without email verification (recommended for early-stage DX).
REQUIRE_EMAIL_VERIFICATION_FOR_PUBLISH = "false"

[[d1_databases]]
binding = "DB"
database_name = "skild-registry"
database_id = "3ffc8dc6-d318-41a6-9f79-db8a80642df6"

[[r2_buckets]]
binding = "BUCKET"
bucket_name = "skild-registry-artifacts"

[triggers]
crons = ["0 2 * * *"] # Daily discovery/metrics refresh
