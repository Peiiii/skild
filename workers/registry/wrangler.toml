name = "skild-registry"
main = "src/index.ts"
compatibility_date = "2025-01-12"

routes = [
  { pattern = "registry.skild.sh/*", zone_name = "skild.sh" }
]

[vars]
# Cloudflare Workers WebCrypto PBKDF2 has an iteration upper bound (100000).
PBKDF2_ITERATIONS = "100000"
REGISTRY_PUBLIC_URL = "https://registry.skild.sh"
CONSOLE_PUBLIC_URL = "https://hub.skild.sh"

# Email verification (publish requires verified email).
# Modes:
# - "mailchannels" (recommended for prod): send emails via MailChannels.
# - "log": do not send; log the verification link (dev only).
EMAIL_MODE = "mailchannels"
EMAIL_FROM = "no-reply@skild.sh"
EMAIL_FROM_NAME = "skild"
EMAIL_VERIFY_TTL_HOURS = "24"

# Temporarily allow publishing without email verification (recommended for early-stage DX).
REQUIRE_EMAIL_VERIFICATION_FOR_PUBLISH = "false"

CATALOG_REPO_SCAN_BATCH = "2"
CATALOG_SCAN_CONCURRENCY = "1"
CATALOG_SCAN_DELAY_MS = "0"
CATALOG_MAX_SKILLS_PER_REPO = "20"
CATALOG_ENRICH_META = "false"
CATALOG_SKIP_UNCHANGED = "true"
CATALOG_RESCAN_TTL_HOURS = "168"
CATALOG_SCAN_MAX_DURATION_MS = "540000"
CATALOG_SCAN_MAX_BATCHES = "1"
CATALOG_FETCH_README = "false"
CATALOG_TAGGING_ENABLED = "true"
CATALOG_TAGGING_BATCH_SIZE = "10"
CATALOG_TAGGING_DELAY_MS = "200"
DISCOVER_CRON_ENABLED = "false"
REPO_METRICS_REFRESH_LIMIT = "0"
DASHSCOPE_MODEL = "qwen-flash"

[[d1_databases]]
binding = "DB"
database_name = "skild-registry"
database_id = "3ffc8dc6-d318-41a6-9f79-db8a80642df6"

[[r2_buckets]]
binding = "BUCKET"
bucket_name = "skild-registry-artifacts"

[triggers]
crons = ["*/1 * * * *"] # Frequent discovery/metrics refresh
